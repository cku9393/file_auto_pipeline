# í™•ì¥ ì„¤ê³„ì„œ: í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬ + ì±„íŒ… UI + AI íŒŒì‹±

## ê°œìš”

ê¸°ì¡´ íŒŒì´í”„ë¼ì¸ ì„¤ê³„ë¥¼ í™•ì¥í•˜ì—¬ ë‹¤ìŒ ê¸°ëŠ¥ì„ ì¶”ê°€í•©ë‹ˆë‹¤:

1. **í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬**: ì˜ˆì‹œ ë¬¸ì„œ â†’ í…œí”Œë¦¿ ìƒì„±/ì €ì¥/ê´€ë¦¬
2. **ì±„íŒ… UI**: ëŒ€í™”í˜• ì…ë ¥ ì¸í„°í˜ì´ìŠ¤ (ììœ  í˜•ì‹)
3. **AI íŒŒì‹±**: Claude APIë¡œ ì…ë ¥ ì •ë¦¬ + Gemini APIë¡œ OCR
4. **Override ì‹œìŠ¤í…œ**: "ì—†ì–´ë„ ì§„í–‰" í—ˆìš© + ê°ì‚¬ ë¡œê·¸
5. **ì›ë³¸ í˜•ì‹ ì¶œë ¥**: ë¬¸ì„œâ†’DOCX, í‘œâ†’XLSX

---

## í•µì‹¬ ë³€ê²½: ì…ë ¥ â†’ íŒŒì‹± â†’ ì¶œë ¥ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì‚¬ìš©ì ì…ë ¥ (ì±„íŒ…)                          â”‚
â”‚                                                                 â”‚
â”‚  "WO-001, L1 ë¼ì¸, PART-A í’ˆë²ˆì´ê³                               â”‚
â”‚   ì¸¡ì •ê°’ì€ ê¸¸ì´ 10.05, í­ 5.02ì•¼.                               â”‚
â”‚   ì‚¬ì§„ì´ë‘ ì—‘ì…€ íŒŒì¼ë„ ì²¨ë¶€í• ê²Œ."                                â”‚
â”‚                                                                 â”‚
â”‚  [ğŸ“ packet.xlsx] [ğŸ“ photo.jpg] [ğŸ“ scan.pdf]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI íŒŒì‹± ë ˆì´ì–´                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Gemini 3.0 Pro  â”‚    â”‚ Claude Opus 4.5 â”‚                    â”‚
â”‚  â”‚ (OCR)           â”‚    â”‚ (êµ¬ì¡°í™”)         â”‚                    â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚                    â”‚
â”‚  â”‚ â€¢ ì´ë¯¸ì§€â†’í…ìŠ¤íŠ¸  â”‚â”€â”€â”€â–¶â”‚ â€¢ í•„ë“œ ì¶”ì¶œ     â”‚                    â”‚
â”‚  â”‚ â€¢ PDFâ†’í…ìŠ¤íŠ¸    â”‚    â”‚ â€¢ ì¸¡ì •ê°’ íŒŒì‹±   â”‚                    â”‚
â”‚  â”‚ â€¢ ìŠ¤ìº”ë¬¸ì„œ ì¸ì‹  â”‚    â”‚ â€¢ ê²€ì¦/ì •ë¦¬     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                  â”‚                              â”‚
â”‚                                  â–¼                              â”‚
â”‚                         êµ¬ì¡°í™”ëœ ë°ì´í„°                          â”‚
â”‚                         (NormalizedPacket)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ê¸°ì¡´ íŒŒì´í”„ë¼ì¸                               â”‚
â”‚                                                                 â”‚
â”‚  Validate â†’ SSOT â†’ Photos â†’ Hash â†’ Render â†’ Package            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì‚°ì¶œë¬¼ (ì›ë³¸ í˜•ì‹)                          â”‚
â”‚                                                                 â”‚
â”‚  â€¢ report.docx     (ë¬¸ì„œ â†’ Word)                                â”‚
â”‚  â€¢ measurements.xlsx (í‘œ â†’ Excel)                               â”‚
â”‚  â€¢ photos/derived/  (ì‚¬ì§„)                                      â”‚
â”‚  â€¢ job.json + logs/ (ë©”íƒ€/ë¡œê·¸)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. í´ë” êµ¬ì¡°

```
manufacturing-docs-pipeline/
â”‚
â”œâ”€â”€ definition.yaml              # ì…ë ¥ ê³„ì•½ SSOT (override_allowed ì¶”ê°€)
â”œâ”€â”€ pixi.toml                    # ì˜ì¡´ì„±
â”œâ”€â”€ README.md
â”‚
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ default.yaml             # ê¸°ë³¸ ì„¤ì • (ëª¨ë¸, ê²½ë¡œ ë“±)
â”‚   â””â”€â”€ production.yaml
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ spec.md                  # ê¸°ì¡´ + í™•ì¥ ì‚¬í•­ ì¶”ê°€
â”‚   â”œâ”€â”€ AGENTS.md
â”‚   â”œâ”€â”€ runbook.md
â”‚   â””â”€â”€ decisions/
â”‚       â”œâ”€â”€ ADR-0001.md          # job.json SSOT
â”‚       â”œâ”€â”€ ADR-0002.md          # [ì‹ ê·œ] í…œí”Œë¦¿ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ê³„
â”‚       â””â”€â”€ ADR-0003.md          # [ì‹ ê·œ] AI íŒŒì‹± ë ˆì´ì–´ ì„¤ê³„
â”‚
â”œâ”€â”€ templates/                   # [ë³€ê²½] í…œí”Œë¦¿ ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ base/                    # ê¸°ë³¸ í…œí”Œë¦¿ (íŒ€ í‘œì¤€)
â”‚   â”‚   â”œâ”€â”€ report.docx          # docxtpl í…œí”Œë¦¿
â”‚   â”‚   â”œâ”€â”€ report.xlsx          # openpyxl í…œí”Œë¦¿
â”‚   â”‚   â””â”€â”€ manifest.yaml        # placeholder, mappings, doc_type
â”‚   â”‚
â”‚   â””â”€â”€ custom/                  # [ë³€ê²½] ì‚¬ìš©ì ì •ì˜ í…œí”Œë¦¿
â”‚       â””â”€â”€ <template_id>/
â”‚           â”œâ”€â”€ source/          # ì‚¬ìš©ìê°€ ë˜ì§„ ì˜ˆì‹œ ì›ë³¸ (ê°ì‚¬ìš©)
â”‚           â”‚   â”œâ”€â”€ example.docx
â”‚           â”‚   â”œâ”€â”€ example.xlsx
â”‚           â”‚   â””â”€â”€ photos/
â”‚           â”œâ”€â”€ compiled/        # ì‹¤ì œ ë Œë”ì— ì“°ëŠ” í…œí”Œë¦¿ (placeholder í¬í•¨)
â”‚           â”‚   â”œâ”€â”€ report.docx
â”‚           â”‚   â””â”€â”€ report.xlsx
â”‚           â”œâ”€â”€ manifest.yaml    # placeholder, excel mappings
â”‚           â””â”€â”€ meta.json        # created_at, author, notes, derived_from
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ app/                     # [ë³€ê²½] UI ì„œë²„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI entry
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py          # ì±„íŒ… ì…ë ¥/ì„¸ì…˜
â”‚   â”‚   â”‚   â”œâ”€â”€ templates.py     # í…œí”Œë¦¿ ê´€ë¦¬ (ê¸°ë³¸/ì˜ˆì‹œ)
â”‚   â”‚   â”‚   â””â”€â”€ generate.py      # ìƒì„± ìš”ì²­
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ intake.py        # ì±„íŒ…/íŒŒì¼ â†’ intake_session.json
â”‚   â”‚   â”‚   â”œâ”€â”€ ocr.py           # Gemini OCR (ë¶„ë¦¬ëœ ë‹¨ê³„)
â”‚   â”‚   â”‚   â”œâ”€â”€ extract.py       # Claude êµ¬ì¡°í™” (JSON)
â”‚   â”‚   â”‚   â””â”€â”€ validate.py      # definition.yaml ê²€ì¦ + override
â”‚   â”‚   â”œâ”€â”€ providers/           # [ì‹ ê·œ] AI Provider Abstraction
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # ì¶”ìƒ ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ anthropic.py     # Claude (ëª¨ë¸ êµì²´ ê°€ëŠ¥)
â”‚   â”‚   â”‚   â””â”€â”€ gemini.py        # Gemini OCR
â”‚   â”‚   â”œâ”€â”€ prompts/             # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”‚   â”‚   â”‚   â”œâ”€â”€ extract_fields.txt
â”‚   â”‚   â”‚   â””â”€â”€ parse_measurements.txt
â”‚   â”‚   â”œâ”€â”€ templates/           # Jinja2 UI í…œí”Œë¦¿ (HTMX)
â”‚   â”‚   â”‚   â”œâ”€â”€ base.html
â”‚   â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.html
â”‚   â”‚   â”‚   â”œâ”€â”€ register.html
â”‚   â”‚   â”‚   â”œâ”€â”€ templates.html
â”‚   â”‚   â”‚   â””â”€â”€ jobs.html
â”‚   â”‚   â””â”€â”€ static/
â”‚   â”‚       â”œâ”€â”€ css/style.css
â”‚   â”‚       â””â”€â”€ js/app.js        # HTMX ê¸°ë°˜ (ìµœì†Œ JS)
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                    # [ë³€ê²½] í•µì‹¬ íŒŒì´í”„ë¼ì¸ (ì•ˆì „ ì½”ì–´)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ ssot_job.py          # job.json lock/mismatch/corrupt
â”‚   â”‚   â”œâ”€â”€ ids.py               # job_id/run_id ìƒì„±
â”‚   â”‚   â”œâ”€â”€ photos.py            # rawâ†’derived, safe_move, archive
â”‚   â”‚   â”œâ”€â”€ hashing.py           # packet_hash/full_hash
â”‚   â”‚   â””â”€â”€ logging.py           # run log schema/events/warnings
â”‚   â”‚
â”‚   â”œâ”€â”€ render/                  # [ë³€ê²½] ì¶œë ¥ ë Œë”ëŸ¬
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ word.py              # docxtpl ë Œë”
â”‚   â”‚   â””â”€â”€ excel.py             # openpyxl ë Œë”
â”‚   â”‚
â”‚   â””â”€â”€ templates/               # í…œí”Œë¦¿ ê´€ë¦¬ ëª¨ë“ˆ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ manager.py           # template_id/manifest/source/compiled
â”‚       â””â”€â”€ scaffolder.py        # ì˜ˆì‹œ â†’ í…œí”Œë¦¿ ìƒì„± (2ë‹¨ê³„)
â”‚
â”œâ”€â”€ jobs/                        # ì‘ì—… í´ë”
â”‚   â””â”€â”€ <job_folder>/
â”‚       â”œâ”€â”€ job.json             # SSOT
â”‚       â”œâ”€â”€ inputs/              # [ì‹ ê·œ] ì…ë ¥ ì›ë³¸ ë³´ê´€
â”‚       â”‚   â”œâ”€â”€ intake_session.json  # ì±„íŒ…/íŒŒì¼ ì›ë¬¸ (ê°ì‚¬ìš©)
â”‚       â”‚   â””â”€â”€ uploads/         # ì—…ë¡œë“œëœ íŒŒì¼
â”‚       â”œâ”€â”€ photos/
â”‚       â”‚   â”œâ”€â”€ raw/
â”‚       â”‚   â””â”€â”€ derived/
â”‚       â”‚       â””â”€â”€ _trash/
â”‚       â”œâ”€â”€ logs/
â”‚       â”‚   â””â”€â”€ run_<run_id>.json
â”‚       â””â”€â”€ deliverables/
â”‚           â”œâ”€â”€ report.docx
â”‚           â”œâ”€â”€ report.xlsx
â”‚           â””â”€â”€ (optional) report.pdf
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ conftest.py
```

---

## 2. ëª¨ë“ˆ ê²½ê³„

### 2.1 ì—­í•  ë¶„ë¦¬ ì›ì¹™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     src/app/ (UI ì„œë²„)                          â”‚
â”‚  - ì±„íŒ… ì…ë ¥, íŒŒì¼ ì—…ë¡œë“œ, ì„¸ì…˜ ê´€ë¦¬                             â”‚
â”‚  - OCR/LLM í˜¸ì¶œ, ì‚¬ìš©ì í™•ì¸ UI                                  â”‚
â”‚  - âš ï¸ ìš´ì˜ ì•ˆì „ ë¡œì§ ì—†ìŒ (coreì— ìœ„ì„)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     src/core/ (ì•ˆì „ ì½”ì–´)                        â”‚
â”‚  - SSOT (job.json), ë½, í•´ì‹œ, derived ì •ê·œí™”                     â”‚
â”‚  - ì—¬ê¸°ë§Œ ê±´ë“œë¦¬ë©´ ìš´ì˜ì‚¬ê³  â†’ ê°€ì¥ ë³´ìˆ˜ì ìœ¼ë¡œ ê´€ë¦¬                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     src/render/ (ì¶œë ¥ ë Œë”ëŸ¬)                    â”‚
â”‚  - DOCX/XLSX ìƒì„±                                               â”‚
â”‚  - í…œí”Œë¦¿ + ë°ì´í„° â†’ ìµœì¢… íŒŒì¼                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     src/templates/ (í…œí”Œë¦¿ ê´€ë¦¬)                 â”‚
â”‚  - í…œí”Œë¦¿ ë“±ë¡/ì¡°íšŒ/ì‚­ì œ                                         â”‚
â”‚  - ì˜ˆì‹œ â†’ í…œí”Œë¦¿ ìŠ¤ìºí´ë”©                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ëª¨ë“ˆë³„ ì±…ì„

| ëª¨ë“ˆ | ì—­í•  | í•µì‹¬ ì›ì¹™ |
|------|------|-----------|
| `app/services/intake.py` | ì±„íŒ…/íŒŒì¼ â†’ intake_session.json | ì›ë³¸ ë³´ê´€ (ê°ì‚¬ìš©) |
| `app/services/ocr.py` | ì´ë¯¸ì§€/PDF â†’ í…ìŠ¤íŠ¸ | ì‹¤íŒ¨ ì‹œ ì‚¬ëŒ í™•ì¸ |
| `app/services/extract.py` | ìì—°ì–´ â†’ êµ¬ì¡°í™” JSON | LLMì€ **ì…ë ¥ ì •ë¦¬ë§Œ** |
| `app/services/validate.py` | definition.yaml ê¸°ë°˜ ê²€ì¦ | override ì²˜ë¦¬ |
| `core/ssot_job.py` | job.json ê´€ë¦¬, ë½ | **ìš´ì˜ ì•ˆì „ í•µì‹¬** |
| `core/photos.py` | rawâ†’derived, safe_move | ì•„ì¹´ì´ë¸Œ ë¡œê·¸ |
| `core/hashing.py` | packet_hash/full_hash | ì¬í˜„ì„± ë³´ì¥ |
| `render/word.py` | DOCX ìƒì„± (docxtpl) | í…œí”Œë¦¿ ë Œë”ë§ |
| `render/excel.py` | XLSX ìƒì„± (openpyxl) | Named Range ê¶Œì¥ |
| `templates/manager.py` | í…œí”Œë¦¿ CRUD | source/compiled ë¶„ë¦¬ |
| `templates/scaffolder.py` | ì˜ˆì‹œ â†’ í…œí”Œë¦¿ ìƒì„± | **ê²€ìˆ˜ í•„ìˆ˜** |

### 2.3 ëª¨ë“ˆ ì˜ì¡´ì„± íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        app/main.py                          â”‚
â”‚                            â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â–¼                           â–¼                  â”‚
â”‚      app/routes/chat.py          app/routes/generate.py     â”‚
â”‚              â”‚                           â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                            â–¼                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚    app/services/*       â”‚                    â”‚
â”‚              â”‚  (intake, ocr, extract) â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                            â–¼                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚      templates/*        â”‚                    â”‚
â”‚              â”‚  (manager, scaffolder)  â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                            â–¼                                â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚        â–¼                                       â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  core/*   â”‚                         â”‚  render/* â”‚        â”‚
â”‚  â”‚ (ssot,    â”‚                         â”‚ (word,    â”‚        â”‚
â”‚  â”‚  photos,  â”‚                         â”‚  excel)   â”‚        â”‚
â”‚  â”‚  hashing) â”‚                         â”‚           â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. CLI ëª…ë ¹

### 3.1 ëª…ë ¹ì–´ ëª©ë¡

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `pixi run generate` | ë³´ê³ ì„œ ìƒì„± (ê¸°ì¡´ pipeline) |
| `pixi run register-template` | ì˜ˆì‹œ â†’ í…œí”Œë¦¿ ë“±ë¡ |
| `pixi run serve` | ì›¹ UI ì„œë²„ ì‹œì‘ |

### 3.2 ìƒì„¸

#### `generate` (ê¸°ì¡´ í™•ì¥)

```bash
# ê¸°ë³¸ í…œí”Œë¦¿ìœ¼ë¡œ ìƒì„±
pixi run generate jobs/demo_001

# ì˜ˆì‹œ í…œí”Œë¦¿ ì„ íƒ
pixi run generate jobs/demo_001 --template inspection/customer_a

# Override í—ˆìš© (ëŒ€í™”í˜•)
pixi run generate jobs/demo_001 --allow-override

# PDF í¬í•¨
pixi run generate jobs/demo_001 --pdf
```

#### `register-template` (ì‹ ê·œ)

```bash
# ì˜ˆì‹œ ë¬¸ì„œë¡œ í…œí”Œë¦¿ ë“±ë¡
pixi run register-template \
  --doc-type inspection \
  --name customer_a \
  --example-report ./examples/report.pdf \
  --example-input ./examples/input.xlsx \
  --example-photos ./examples/photos/

# ê²°ê³¼: templates/custom/customer_a/ ìƒì„±
```

#### `serve` (ì‹ ê·œ)

```bash
# ê°œë°œ ëª¨ë“œ (ìë™ ë¦¬ë¡œë“œ)
pixi run serve --dev

# í”„ë¡œë•ì…˜ ëª¨ë“œ
pixi run serve --host 0.0.0.0 --port 8080

# ê¸°ë³¸: http://localhost:8000
```

### 3.3 pixi.toml ì¶”ê°€ íƒœìŠ¤í¬

```toml
[tasks]
# CLI (core íŒŒì´í”„ë¼ì¸)
generate = "python -m src.core.pipeline"

# í…œí”Œë¦¿ ê´€ë¦¬
register-template = "python -m src.templates.cli"

# ì›¹ ì„œë²„
serve = "python -m src.app.main"
serve-dev = "uvicorn src.app.main:app --reload"
```

---

## 4. UI ë¼ìš°íŠ¸

### 4.1 í˜ì´ì§€ ë¼ìš°íŠ¸ (HTML)

| ê²½ë¡œ | í™”ë©´ | ì„¤ëª… |
|------|------|------|
| `GET /` | í™ˆ | ëŒ€ì‹œë³´ë“œ, ìµœê·¼ ì‘ì—…, ë¹ ë¥¸ ì‹œì‘ |
| `GET /chat` | **ì±„íŒ…** | ëŒ€í™”í˜• ë¬¸ì„œ ìƒì„± (ë©”ì¸ ê¸°ëŠ¥) |
| `GET /register` | í…œí”Œë¦¿ ë“±ë¡ | ì˜ˆì‹œ ì—…ë¡œë“œ + ìŠ¤ìºí´ë”© |
| `GET /templates` | í…œí”Œë¦¿ ê´€ë¦¬ | ëª©ë¡, ìƒíƒœ, ì‚­ì œ/ë¹„í™œì„±í™” |
| `GET /jobs` | ì‘ì—… ì´ë ¥ | job/run ë¡œê·¸, ê²°ê³¼ë¬¼ |
| `GET /jobs/<job_id>` | ì‘ì—… ìƒì„¸ | íŠ¹ì • job ìƒì„¸ ì •ë³´ |

### 4.2 API ë¼ìš°íŠ¸ (REST + SSE)

> **ê²°ì •**: ê¸°ë³¸ì€ REST + SSE(Server-Sent Events). WebSocketì€ ì˜µì…˜.  
> HTMX ê¸°ë°˜ ìµœì†Œ ìŠ¤íƒ ì² í•™ ìœ ì§€.

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| `GET /api/chat/stream` | **SSE ìŠ¤íŠ¸ë¦¼** | ì‹¤ì‹œê°„ ì‘ë‹µ (HTMX hx-sse) |
| `POST /api/chat/message` | ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ |
| `POST /api/chat/upload` | ì±„íŒ… ì¤‘ íŒŒì¼ ì²¨ë¶€ |
| `POST /api/generate` | ìµœì¢… ë¬¸ì„œ ìƒì„± ìš”ì²­ |
| `POST /api/templates` | í…œí”Œë¦¿ ë“±ë¡ |
| `GET /api/templates` | í…œí”Œë¦¿ ëª©ë¡ |
| `GET /api/templates/<id>` | í…œí”Œë¦¿ ìƒì„¸ |
| `PATCH /api/templates/<id>` | í…œí”Œë¦¿ ìƒíƒœ ë³€ê²½ |
| `DELETE /api/templates/<id>` | í…œí”Œë¦¿ ì‚­ì œ |
| `GET /api/jobs` | ì‘ì—… ëª©ë¡ |
| `GET /api/jobs/<job_id>` | ì‘ì—… ìƒì„¸ |
| `GET /api/jobs/<job_id>/download/<file>` | íŒŒì¼ ë‹¤ìš´ë¡œë“œ |

### 4.3 UI í™”ë©´ ìƒì„¸

#### 4.3.1 ì±„íŒ… í™”ë©´ (`/chat`) - ë©”ì¸ ê¸°ëŠ¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ ë¬¸ì„œ ìƒì„±                              [í…œí”Œë¦¿: ê¸°ë³¸ â–¼]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€ ëŒ€í™” ì˜ì—­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ¤– ì•ˆë…•í•˜ì„¸ìš”! ë¬¸ì„œ ìƒì„±ì„ ë„ì™€ë“œë¦´ê²Œìš”.               â”‚   â”‚
â”‚  â”‚     ì‘ì—… ì •ë³´ë¥¼ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.                   â”‚   â”‚
â”‚  â”‚     (ì—‘ì…€, ì‚¬ì§„, PDF ë“± íŒŒì¼ë„ ì²¨ë¶€ ê°€ëŠ¥í•©ë‹ˆë‹¤)          â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ‘¤ WO-001, L1 ë¼ì¸, PART-A í’ˆë²ˆì´ì•¼.                   â”‚   â”‚
â”‚  â”‚     ì¸¡ì •ê°’ì€ ê¸¸ì´ 10.05, í­ 5.02ê³  ë‘˜ ë‹¤ PASS.          â”‚   â”‚
â”‚  â”‚     [ğŸ“ packet.xlsx] [ğŸ“ overview.jpg]                  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ¤– íŒŒì¼ì„ ë¶„ì„í–ˆì–´ìš”. ì¶”ì¶œëœ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”:       â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€ ì¶”ì¶œ ê²°ê³¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ âœ… ì‘ì—…ì§€ì‹œ: WO-001                            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ âœ… ë¼ì¸: L1                                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ âœ… í’ˆë²ˆ: PART-A                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ âš ï¸ ê²€ì‚¬ì: (ì…ë ¥ ì•ˆë¨) [ì—†ì´ ì§„í–‰ â–¼]           â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ì¸¡ì • ë°ì´í„° (2í–‰):                             â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ í•­ëª©  â”‚ ê·œê²©    â”‚ ì¸¡ì •ê°’  â”‚ ê²°ê³¼ â”‚          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ ê¸¸ì´  â”‚ 10Â±0.1 â”‚ 10.05  â”‚ PASS â”‚          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â”‚ í­    â”‚ 5Â±0.1  â”‚ 5.02   â”‚ PASS â”‚          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                                                â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ ì‚¬ì§„ (1/2):                                    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ âœ… ì „ì²´ ì‚¬ì§„: overview.jpg                     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ âŒ ë¼ë²¨ ì‚¬ì§„: (í•„ìš”)                           â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  [ìˆ˜ì •í•˜ê¸°]  [ë¼ë²¨ ì‚¬ì§„ ì¶”ê°€]  [ë¬¸ì„œ ìƒì„±í•˜ê¸°]           â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ ì…ë ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [ë©”ì‹œì§€ ì…ë ¥...                                    ]     â”‚   â”‚
â”‚  â”‚                                           [ğŸ“] [ì „ì†¡]    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3.2 "ì—†ì´ ì§„í–‰" ë“œë¡­ë‹¤ìš´ (Override)

```
â”Œâ”€ ê²€ì‚¬ì: (ì…ë ¥ ì•ˆë¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ì—†ì´ ì§„í–‰ â–¼]                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ ë‹¤ì‹œ ì…ë ¥í• ê²Œìš”              â”‚   â”‚
â”‚  â”‚ â— ì—†ì´ ì§„í–‰ (ì‚¬ìœ  í•„ìˆ˜)        â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚ í˜„ì¥ ë‹´ë‹¹ì ë¯¸ì§€ì •      â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚ [í™•ì¸]                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.3.3 ë¬¸ì„œ ìƒì„± ì™„ë£Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  ğŸ¤– ë¬¸ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰                                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€ ìƒì„±ëœ íŒŒì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“„ report.docx          [ë‹¤ìš´ë¡œë“œ]  [ë¯¸ë¦¬ë³´ê¸°]         â”‚   â”‚
â”‚  â”‚  ğŸ“Š measurements.xlsx    [ë‹¤ìš´ë¡œë“œ]  [ë¯¸ë¦¬ë³´ê¸°]         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  ğŸ“ ì „ì²´ ë‹¤ìš´ë¡œë“œ (ZIP)  [ë‹¤ìš´ë¡œë“œ]                     â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  [ìƒˆ ë¬¸ì„œ ë§Œë“¤ê¸°]  [ì‘ì—… ì´ë ¥ ë³´ê¸°]                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. definition.yaml í™•ì¥

### 5.1 Override ì •ì±… ì¶”ê°€

```yaml
# definition.yaml

definition_version: "1.1"  # ë²„ì „ ì—…

fields:
  wo_no:
    type: token
    importance: critical
    override_allowed: false    # [ì‹ ê·œ] ì ˆëŒ€ ìƒëµ ë¶ˆê°€
    aliases: ["WO", "ì‘ì—…ì§€ì‹œ", "Work Order"]

  line:
    type: token
    importance: critical
    override_allowed: false
    aliases: ["Line", "ë¼ì¸", "LINE"]

  inspector:
    type: free_text
    importance: reference
    override_allowed: true     # [ì‹ ê·œ] ìƒëµ ê°€ëŠ¥ (ì‚¬ìœ  í•„ìˆ˜)
    aliases: ["ê²€ì‚¬ì", "Inspector", "ë‹´ë‹¹ì"]

  remark:
    type: free_text
    importance: reference
    override_allowed: true
    aliases: ["ë¹„ê³ ", "Remark", "Note"]

photos:
  slots:
    - key: overview
      required: true
      override_allowed: false   # [ì‹ ê·œ] ì ˆëŒ€ í•„ìš”
      
    - key: label_serial
      required: true
      override_allowed: false
      
    - key: measurement_setup
      required: false
      override_allowed: true    # [ì‹ ê·œ] ì—†ì–´ë„ ì§„í–‰ ê°€ëŠ¥
      
    - key: defect
      required: false
      override_allowed: true
```

### 5.2 Override ë¡œê·¸ ìŠ¤í‚¤ë§ˆ

```json
{
  "run_id": "...",
  "job_id": "...",
  "result": "success",
  "overrides": [
    {
      "code": "OVERRIDE_APPLIED",
      "timestamp": "2024-01-15T09:30:00Z",
      "field_or_slot": "inspector",
      "type": "field",
      "reason": "í˜„ì¥ ë‹´ë‹¹ì ë¯¸ì§€ì •ìœ¼ë¡œ ìƒëµ",
      "user": "í™ê¸¸ë™"
    },
    {
      "code": "OVERRIDE_APPLIED",
      "timestamp": "2024-01-15T09:30:00Z",
      "field_or_slot": "measurement_setup",
      "type": "photo",
      "reason": "í˜„ì¥ ë‹´ë‹¹ì ë¯¸ì§€ì •ìœ¼ë¡œ ìƒëµ",
      "user": "í™ê¸¸ë™"
    }
  ]
}
```

---

## 6. í…œí”Œë¦¿ ì‹œìŠ¤í…œ ìƒì„¸

### 6.1 í…œí”Œë¦¿ ìƒì„± 2ë‹¨ê³„ ì ‘ê·¼

> âš ï¸ "ì™„ì „ ìë™"ìœ¼ë¡œ 100% ë™ì¼ ë ˆì´ì•„ì›ƒ ì¬í˜„ì€ ìœ ë ¹ë²„ê·¸ì˜ ì§€ë¦„ê¸¸.
> **ê²€ìˆ˜ ë‹¨ê³„ê°€ í•„ìˆ˜**ì…ë‹ˆë‹¤.

#### ë ˆë²¨ 1: ìë™ (ì•ˆì •)

ì˜ˆì‹œ ë¬¸ì„œê°€ **ì´ë¯¸ placeholderë¥¼ í¬í•¨**í•œ ê²½ìš°:

```
ì˜ˆì‹œ DOCX: "ì‘ì—…ì§€ì‹œ: {{wo_no}}"
ì˜ˆì‹œ XLSX: Named Range "wo_no" ë˜ëŠ” íŠ¹ì • ì…€ ë§¤í•‘
         â†“
    ê·¸ëŒ€ë¡œ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥ ê°€ëŠ¥
```

#### ë ˆë²¨ 2: ë°˜ìë™ (í˜„ì‹¤ ë°©íƒ„)

ì˜ˆì‹œ ë¬¸ì„œê°€ **ì™„ì„±ë³¸**ì´ê³  placeholderê°€ ì—†ëŠ” ê²½ìš°:

```
ì˜ˆì‹œ DOCX: "ì‘ì—…ì§€ì‹œ: WO-001"
         â†“
    1. LLMì´ ë¼ë²¨ íŒ¨í„´ ê°ì§€ ("ì‘ì—…ì§€ì‹œ:", "Part No:" ë“±)
    2. placeholder ì‚½ì…ëœ ì´ˆì•ˆ ìƒì„±
    3. ì‚¬ìš©ì ê²€ìˆ˜/ìˆ˜ì • UI
    4. í™•ì • í›„ compiled/ì— ì €ì¥
```

### 6.2 í…œí”Œë¦¿ ì €ì¥ êµ¬ì¡°

```
templates/
â”œâ”€â”€ base/                        # íŒ€ í‘œì¤€ (ë³€ê²½ ì ìŒ)
â”‚   â”œâ”€â”€ report.docx              # {{wo_no}}, {{part_no}} ë“±
â”‚   â”œâ”€â”€ report.xlsx              # Named Range ê¸°ë°˜
â”‚   â””â”€â”€ manifest.yaml
â”‚
â””â”€â”€ custom/<template_id>/        # ì‚¬ìš©ì ì •ì˜
    â”œâ”€â”€ source/                  # ì›ë³¸ ë³´ê´€ (ê°ì‚¬ìš©, ìˆ˜ì • ê¸ˆì§€)
    â”‚   â”œâ”€â”€ example.docx
    â”‚   â””â”€â”€ example.xlsx
    â”œâ”€â”€ compiled/                # ì‹¤ì œ ë Œë”ì— ì‚¬ìš©
    â”‚   â”œâ”€â”€ report.docx          # placeholder í¬í•¨
    â”‚   â””â”€â”€ report.xlsx
    â”œâ”€â”€ manifest.yaml            # ë§¤í•‘ ì •ë³´
    â””â”€â”€ meta.json                # ë©”íƒ€ë°ì´í„°
```

### 6.3 meta.json

```json
{
  "template_id": "customer_a",
  "doc_type": "inspection",
  "display_name": "ê³ ê°ì‚¬A ê²€ì‚¬ì„±ì ì„œ",
  "description": "ê³ ê°ì‚¬A ì „ìš© ê²€ì‚¬ì„±ì ì„œ ì–‘ì‹",
  
  "status": "ready",
  "version": "1.0",
  
  "created_at": "2024-01-15T09:00:00Z",
  "created_by": "í™ê¸¸ë™",
  "updated_at": "2024-01-15T10:00:00Z",
  
  "derived_from": "source/example.docx",
  "creation_level": "semi-auto",
  "reviewed_by": "ê¹€ì² ìˆ˜",
  "reviewed_at": "2024-01-15T10:30:00Z"
}
```

### 6.4 manifest.yaml

> **XLSX ë§¤í•‘ ìš°ì„ ìˆœìœ„ ì •ì±…**  
> 1. `named_ranges` ìš°ì„  (ê¶Œì¥, í–‰ ì‚½ì…/ì‚­ì œì— ë‚´ì„±)
> 2. `named_ranges` ì—†ìœ¼ë©´ `cell_addresses` ì‚¬ìš©
> 3. **ë™ì¼ í•„ë“œì— ë‘˜ ë‹¤ ìˆìœ¼ë©´ â†’ ì—ëŸ¬ (fail-fast)**
> 4. ì¸¡ì • í…Œì´ë¸”: `start_row` ê¸°ë°˜ â†’ í…œí”Œë¦¿ì— í–‰ ì‚½ì…/ìˆ¨ê¹€/í•„í„° **ê¸ˆì§€**

```yaml
# templates/custom/customer_a/manifest.yaml

# DOCX placeholder ëª©ë¡
docx_placeholders:
  - wo_no
  - line
  - part_no
  - lot_no
  - inspector
  - measurements  # í‘œ ì „ì²´

# XLSX ì…€ ë§¤í•‘
xlsx_mappings:
  # ìš°ì„ ìˆœìœ„ 1: Named Range (ê¶Œì¥)
  named_ranges:
    wo_no: "WO_NO"           # Excel Named Range ì´ë¦„
    part_no: "PART_NO"
  
  # ìš°ì„ ìˆœìœ„ 2: ì§ì ‘ ì…€ ì£¼ì†Œ (Named Range ì—†ì„ ë•Œë§Œ)
  cell_addresses:
    lot_no: "Sheet1!B4"      # named_rangesì— ì—†ëŠ” í•„ë“œë§Œ í—ˆìš©
    inspector: "Sheet1!B5"
  
  # ì¸¡ì • ë°ì´í„° (ë™ì  í–‰)
  measurements:
    sheet: "ì¸¡ì •ë°ì´í„°"
    start_row: 5              # âš ï¸ í…œí”Œë¦¿ì— í–‰ ì‚½ì…/ì‚­ì œ ê¸ˆì§€
    columns:
      item: "A"
      spec: "B"
      measured: "C"
      result: "D"
  
  # ì¶©ëŒ ì²˜ë¦¬ ì •ì±…
  conflict_policy: "fail"     # fail | warn_and_use_named_range

# ë¼ë²¨ ë§¤í•‘ (ë°˜ìë™ ìƒì„± ì‹œ ì‚¬ìš©)
label_mappings:
  "ë°œì£¼ë²ˆí˜¸": "customer_po"
  "W/O No.": "wo_no"
  "Part Number": "part_no"
```

### 6.5 í…œí”Œë¦¿ ìƒì„± íë¦„ (UI)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“„ í…œí”Œë¦¿ ë“±ë¡                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ë‹¨ê³„: ì˜ˆì‹œ ì—…ë¡œë“œ                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [ğŸ“ ì˜ˆì‹œ Word íŒŒì¼] example_report.docx  âœ“                â”‚ â”‚
â”‚  â”‚ [ğŸ“ ì˜ˆì‹œ Excel íŒŒì¼] example_data.xlsx   âœ“                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  2ë‹¨ê³„: ë¶„ì„ ê²°ê³¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ” ê°ì§€ëœ í•„ë“œ:                                           â”‚ â”‚
â”‚  â”‚   âœ… ì‘ì—…ì§€ì‹œ (WO-001) â†’ {{wo_no}}                        â”‚ â”‚
â”‚  â”‚   âœ… í’ˆë²ˆ (PART-A) â†’ {{part_no}}                          â”‚ â”‚
â”‚  â”‚   âš ï¸ "ë‹´ë‹¹" (í™ê¸¸ë™) â†’ {{inspector}}? [ìˆ˜ì •]              â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ ğŸ“Š ì¸¡ì • í…Œì´ë¸”: 5í–‰ ê°ì§€                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  3ë‹¨ê³„: ê²€ìˆ˜ ë° í™•ì •                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ í…œí”Œë¦¿ ì´ë¦„: [ê³ ê°ì‚¬A ê²€ì‚¬ì„±ì ì„œ    ]                      â”‚ â”‚
â”‚  â”‚ ë¶„ë¥˜(doc_type): [inspection â–¼]                            â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚ â˜‘ ë¶„ì„ ê²°ê³¼ë¥¼ ê²€í† í–ˆìŠµë‹ˆë‹¤                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  [ ë¯¸ë¦¬ë³´ê¸° ]  [ í…œí”Œë¦¿ ì €ì¥ ]                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ì˜ì¡´ì„± ì¶”ê°€ (pixi.toml)

```toml
[dependencies]
# ê¸°ì¡´ (íŒŒì´í”„ë¼ì¸ ì½”ì–´)
python = ">=3.10"
openpyxl = ">=3.1"           # Excel ì½ê¸°/ì“°ê¸°
jinja2 = ">=3.1"             # í…œí”Œë¦¿ ë Œë”ë§ (HTML UIìš©)
pyyaml = ">=6.0"
pillow = ">=10.0"            # ì´ë¯¸ì§€ ì²˜ë¦¬
filelock = ">=3.12"

# [ì‹ ê·œ] AI API
anthropic = ">=0.40"         # Claude API
google-generativeai = ">=0.8"  # Gemini API (OCR)

# [ì‹ ê·œ] ì›¹ UI (HTMX ê¸°ë°˜ - ë‹¨ìˆœ)
fastapi = ">=0.109"
uvicorn = ">=0.27"
python-multipart = ">=0.0.6"  # íŒŒì¼ ì—…ë¡œë“œ

# [ì‹ ê·œ] ë¬¸ì„œ ì¶œë ¥ (DOCX/XLSX)
python-docx = ">=1.1"         # DOCX ì½ê¸°
docxtpl = ">=0.16"            # DOCX í…œí”Œë¦¿ ë Œë”ë§
# openpyxl: ì´ë¯¸ í¬í•¨ (Excel ì½ê¸°/ì“°ê¸° í†µí•©)

# [ì„ íƒ] PDF ì¶œë ¥ (í•„ìš”ì‹œ)
# weasyprint = ">=60.0"       # ì‹œìŠ¤í…œ ì˜ì¡´ì„± ìˆìŒ, í•„ìˆ˜ ì•„ë‹˜

# [ì„ íƒ] ê²€ì¦
pydantic = ">=2.0"            # ìŠ¤í‚¤ë§ˆ ê²€ì¦
```

> ğŸ’¡ **HTMX ì‚¬ìš©**: í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì—†ì´ HTML + HTMXë¡œ ë™ì  UI êµ¬í˜„  
> CDN: `<script src="https://unpkg.com/htmx.org@1.9.10"></script>`

### 7.1 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# .env ë˜ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •
ANTHROPIC_API_KEY=sk-ant-...      # Claude API í‚¤
GOOGLE_API_KEY=AI...              # Gemini API í‚¤
```

### 7.2 API í‚¤ ê´€ë¦¬ ì •ì±…

| í™˜ê²½ | ì„¤ì • ë°©ë²• |
|------|-----------|
| ë¡œì»¬ ê°œë°œ | `.env` íŒŒì¼ (gitignore) |
| í”„ë¡œë•ì…˜ | í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ì‹œí¬ë¦¿ ë§¤ë‹ˆì € |
| CI/CD | GitHub Secrets ë“± |

> âš ï¸ API í‚¤ëŠ” ì ˆëŒ€ ì½”ë“œì— í•˜ë“œì½”ë”©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

## 8. AI íŒŒì‹± ë ˆì´ì–´ ìƒì„¸

### 8.1 íŒŒì‹± íë¦„ (ì›ë³¸ ë³´ê´€ + OCR ë¶„ë¦¬)

```
ì‚¬ìš©ì ì…ë ¥ (ì±„íŒ…)
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  intake_session.json ì €ì¥ (ì›ë¬¸ ë³´ê´€ - ê°ì‚¬/ì¬í˜„ìš©)          â”‚
â”‚  - ì±„íŒ… í…ìŠ¤íŠ¸ ì›ë³¸                                         â”‚
â”‚  - ì—…ë¡œë“œ íŒŒì¼ ëª©ë¡                                          â”‚
â”‚  - timestamp, session_id                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ë‹¨ê³„: OCR (Gemini) - ë³„ë„ ë‹¨ê³„ë¡œ ë¶„ë¦¬                      â”‚
â”‚  - ì´ë¯¸ì§€/ìŠ¤ìº”PDF â†’ í…ìŠ¤íŠ¸                                   â”‚
â”‚  - ì‹¤íŒ¨ ì‹œ â†’ ì‚¬ëŒ í™•ì¸ UXë¡œ ë˜ëŒë¦¼                           â”‚
â”‚  - OCR ê²°ê³¼ë„ intake_session.jsonì— ì¶”ê°€ ì €ì¥                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ë‹¨ê³„: êµ¬ì¡°í™” (Claude Opus 4.5)                             â”‚
â”‚  - ì…ë ¥: ì±„íŒ… í…ìŠ¤íŠ¸ + OCR í…ìŠ¤íŠ¸ + definition.yaml          â”‚
â”‚  - ì¶œë ¥: JSON (packet + warnings + missing + template_id)   â”‚
â”‚                                                             â”‚
â”‚  âš ï¸ LLMì€ ì…ë ¥ ì •ë¦¬ë§Œ ë‹´ë‹¹                                   â”‚
â”‚  âš ï¸ SSOT/í•´ì‹œ/ë½/derived ì •ê·œí™”ëŠ” ê¸°ì¡´ íŒŒì´í”„ë¼ì¸ì´ ë‹´ë‹¹     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ë‹¨ê³„: ê²€ì¦ (definition.yaml ê¸°ë°˜)                          â”‚
â”‚  - í•„ìˆ˜ í•„ë“œ ì²´í¬                                            â”‚
â”‚  - override ì²˜ë¦¬ (ì‚¬ìš©ì ìŠ¹ì¸ ì‹œ)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
ê¸°ì¡´ íŒŒì´í”„ë¼ì¸ (SSOT â†’ Photos â†’ Hash â†’ Render â†’ Package)
```

### 8.2 Provider Abstraction (ëª¨ë¸ êµì²´ ê°€ëŠ¥)

```python
# src/ai/providers/base.py

from abc import ABC, abstractmethod

class LLMProvider(ABC):
    @abstractmethod
    async def complete(self, prompt: str, **kwargs) -> str:
        pass

class OCRProvider(ABC):
    @abstractmethod
    async def extract_text(self, file_bytes: bytes, file_type: str) -> str:
        pass
```

```python
# src/ai/providers/anthropic.py

class ClaudeProvider(LLMProvider):
    def __init__(self, model: str = "claude-opus-4-5-20251101"):
        self.model = model  # configì—ì„œ êµì²´ ê°€ëŠ¥
        
    async def complete(self, prompt: str, **kwargs) -> str:
        # Anthropic API í˜¸ì¶œ
        pass
```

```python
# src/app/providers/gemini.py

FALLBACK_ERRORS = (NotFound, ServiceUnavailable, ResourceExhausted, ModelLoadError)
REJECT_IMMEDIATELY = (InvalidArgument, PermissionDenied, Unauthenticated)

class GeminiOCRProvider(OCRProvider):
    def __init__(
        self, 
        model: str = "gemini-3-pro-preview",
        fallback: str = "gemini-2.5-flash"  # Noneì´ë©´ ì¬ì‹œë„ ì—†ì´ ì‹¤íŒ¨
    ):
        self.model = model
        self.fallback = fallback
        
    async def extract_text(self, file_bytes: bytes, file_type: str) -> OCRResult:
        try:
            result = await self._call_api(self.model, file_bytes, file_type)
            result.model_used = self.model
            result.fallback_triggered = False
            return result
        except FALLBACK_ERRORS as e:
            if self.fallback is None:
                raise OCRError("NO_FALLBACK", cause=e)
            result = await self._call_api(self.fallback, file_bytes, file_type)
            result.model_used = self.fallback
            result.fallback_triggered = True
            return result
        except REJECT_IMMEDIATELY as e:
            raise OCRError("AUTH_OR_INPUT_ERROR", cause=e)  # ì¦‰ì‹œ ì‹¤íŒ¨
```

**Fallback ì˜ˆì™¸ ì •ì±…**:

| ì˜ˆì™¸ ìœ í˜• | Fallback | ì„¤ëª… |
|-----------|:--------:|------|
| `NotFound`, `ServiceUnavailable`, `ResourceExhausted`, `ModelLoadError` | âœ… | ì¬ì‹œë„ |
| `InvalidArgument`, `PermissionDenied`, `Unauthenticated` | âŒ | ì¦‰ì‹œ reject |

```yaml
# configs/default.yaml

ai:
  llm:
    provider: anthropic
    model: claude-opus-4-5-20251101  # êµì²´ ê°€ëŠ¥
  ocr:
    provider: gemini
    model: gemini-3-pro-preview      # ê¸°ë³¸ ëª¨ë¸
    fallback: gemini-2.5-flash       # ë¡œë“œ ì‹¤íŒ¨ ì‹œ (nullì´ë©´ ì¬ì‹œë„ ì—†ì´ ì‹¤íŒ¨)
```

### 8.3 Claude í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ

```text
# src/ai/prompts/extract_fields.txt

ë‹¹ì‹ ì€ ì œì¡° ê²€ì‚¬ ë¬¸ì„œì—ì„œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## ì…ë ¥ ê³„ì•½ (definition.yaml ê¸°ì¤€)
{definition_yaml_content}

## ì‚¬ìš©ì ì…ë ¥
{user_input}

## OCR ì¶”ì¶œ í…ìŠ¤íŠ¸ (ìˆëŠ” ê²½ìš°)
{ocr_text}

## ì§€ì‹œì‚¬í•­
1. ìœ„ ì…ë ¥ì—ì„œ í•„ë“œë¥¼ ì¶”ì¶œí•˜ì„¸ìš”
2. ì¸¡ì • ë°ì´í„°ê°€ ìˆë‹¤ë©´ í‘œ í˜•ì‹ìœ¼ë¡œ ì¶”ì¶œí•˜ì„¸ìš”
3. ëˆ„ë½ëœ í•„ìˆ˜ í•„ë“œê°€ ìˆìœ¼ë©´ missing_fieldsì— ëª…ì‹œí•˜ì„¸ìš”

## ì‘ë‹µ í˜•ì‹ (JSONë§Œ)
{
  "fields": {
    "wo_no": "...",
    "line": "...",
    ...
  },
  "measurements": [
    {"item": "...", "spec": "...", "measured": "...", "result": "..."}
  ],
  "missing_fields": ["inspector"],
  "warnings": ["LOT ë²ˆí˜¸ê°€ ë¶ˆëª…í™•í•¨"],
  "confidence": 0.95,
  "suggested_template_id": null
}
```

### 8.4 intake_session.json ìŠ¤í‚¤ë§ˆ

> âš ï¸ **ë¶ˆë³€ì„± ê·œì¹™ (Append-Only)**  
> - `messages` ì›ë¬¸ì€ **ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€** (ê°ì‚¬/ì¬í˜„ ë³´ì¥)
> - í›„ì²˜ë¦¬ ê²°ê³¼(`ocr_results`, `extraction_result`)ëŠ” **append ì´ë²¤íŠ¸ë¡œë§Œ** ì¶”ê°€
> - UIì—ì„œ ì‚¬ìš©ìê°€ ìˆ˜ì •í•œ ê°’ì€ ë³„ë„ `user_corrections` ì„¹ì…˜ì— ê¸°ë¡
> - ì›ë¬¸ ë®ì–´ì“°ê¸° ì‹œë„ ì‹œ â†’ **ì—ëŸ¬ ë°œìƒ**

```json
{
  "schema_version": "1.0",
  "session_id": "uuid-v4",
  "created_at": "2024-01-15T09:30:00Z",
  "immutable": true,
  
  "messages": [
    {
      "role": "user",
      "content": "WO-001, L1 ë¼ì¸, PART-A í’ˆë²ˆì´ì•¼...",
      "timestamp": "2024-01-15T09:30:00Z",
      "attachments": [
        {"filename": "packet.xlsx", "size": 12345, "path": "uploads/..."},
        {"filename": "overview.jpg", "size": 54321, "path": "uploads/..."}
      ]
    }
  ],
  
  "ocr_results": {
    "overview.jpg": {
      "success": true,
      "text": "ì¶”ì¶œëœ í…ìŠ¤íŠ¸...",
      "confidence": 0.92,
      "model_requested": "gemini-3-pro-preview",
      "model_used": "gemini-2.5-flash",
      "fallback_triggered": true,
      "processed_at": "2024-01-15T09:30:05Z"
    }
  },
  
  "extraction_result": {
    "fields": {...},
    "measurements": [...],
    "missing_fields": [...],
    "model_requested": "claude-opus-4-5-20251101",
    "model_used": "claude-opus-4-5-20251101",
    "extracted_at": "2024-01-15T09:30:10Z"
  },
  
  "user_corrections": [
    {
      "field": "inspector",
      "original": null,
      "corrected": "í™ê¸¸ë™",
      "corrected_at": "2024-01-15T09:31:00Z",
      "corrected_by": "user"
    }
  ]
}
```

**ëª¨ë¸ ê¸°ë¡ í•„ìˆ˜ í‚¤** (ê°ì‚¬/ì¬í˜„ì„±):

| í‚¤ | í•„ìˆ˜ | ì„¤ëª… |
|----|:----:|------|
| `model_requested` | âœ… | configì— ì„¤ì •ëœ ëª¨ë¸ |
| `model_used` | âœ… | ì‹¤ì œ í˜¸ì¶œëœ ëª¨ë¸ (fallback ì‹œ ë‹¤ë¦„) |
| `fallback_triggered` | OCRë§Œ | fallback ë°œìƒ ì—¬ë¶€ |

> **ì‹¤íŒ¨ ì •ì±…**: schema_version ëˆ„ë½, messages ë®ì–´ì“°ê¸°, model_used ëˆ„ë½ â†’ **ì—ëŸ¬**

### 8.5 ë¹„ìš© ê´€ë¦¬

> âš ï¸ **ì˜ˆìƒ ë¹„ìš©ì€ ìƒ˜í”Œ ê¸°ì¤€ ì¶”ì •ì¹˜**ì…ë‹ˆë‹¤.  
> ì‹¤ì œ ë¹„ìš©ì€ ì…ë ¥/ì¶œë ¥ í† í° ìˆ˜ì— ë”°ë¼ í¬ê²Œ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> (Claude: $5/$25 per million tokens ê¸°ì¤€)

| ëª¨ë¸ | ìš©ë„ | ì˜ˆìƒ ë¹„ìš©/ê±´ (ì¶”ì •) |
|------|------|---------------------|
| Claude Opus 4.5 | í…ìŠ¤íŠ¸ êµ¬ì¡°í™” | ~$0.05 |
| Gemini 3.0 Pro | ì´ë¯¸ì§€ OCR (ê¸°ë³¸) | ~$0.01 |
| Gemini 2.5 Flash | ì´ë¯¸ì§€ OCR (fallback) | ~$0.005 |

> ğŸ’¡ ë¹„ìš© ì ˆê°: ê°„ë‹¨í•œ íŒ¨í„´(WO-xxx, PART-xxx)ì€ ì •ê·œì‹ìœ¼ë¡œ ë¨¼ì € ì‹œë„

---

## 9. ì¶œë ¥ í˜•ì‹ ìƒì„¸

### 9.1 DOCX ì¶œë ¥ (docxtpl)

```python
# src/render/word.py

from docxtpl import DocxTemplate
from pathlib import Path

def render_docx(template_path: Path, data: dict, output_path: Path):
    """Word ë¬¸ì„œ ìƒì„±"""
    doc = DocxTemplate(template_path)
    doc.render({
        "wo_no": data["wo_no"],
        "line": data["line"],
        "part_no": data["part_no"],
        "measurements": data["measurements"],
        "photos": data["photos"],  # ì´ë¯¸ì§€ ì‚½ì…
        "generated_at": datetime.now().isoformat(),
    })
    doc.save(output_path)
```

### 9.2 XLSX ì¶œë ¥ (openpyxl - í…œí”Œë¦¿ ë³µì‚¬ ë°©ì‹)

```python
# src/render/excel.py

from openpyxl import load_workbook
from pathlib import Path

def render_xlsx(template_path: Path, data: dict, output_path: Path):
    """ì¸¡ì • ë°ì´í„° Excel ìƒì„± (í…œí”Œë¦¿ ë³µì‚¬ í›„ ê°’ ì±„ìš°ê¸°)"""
    # í…œí”Œë¦¿ ë³µì‚¬
    wb = load_workbook(template_path)
    ws = wb.active
    
    # Named Range ë˜ëŠ” ì…€ ì£¼ì†Œë¡œ ê°’ ì±„ìš°ê¸°
    for name, value in data["fields"].items():
        if name in wb.defined_names:
            cell = wb.defined_names[name].destinations
            for sheet, addr in cell:
                wb[sheet][addr] = value
    
    # ì¸¡ì • ë°ì´í„° (ì‹œì‘ í–‰ë¶€í„°)
    start_row = 5  # manifest.yamlì—ì„œ ì½ì–´ì˜´
    for i, row in enumerate(data["measurements"]):
        ws[f"A{start_row + i}"] = row["item"]
        ws[f"B{start_row + i}"] = row["spec"]
        ws[f"C{start_row + i}"] = row["measured"]
        ws[f"D{start_row + i}"] = row["result"]
    
    wb.save(output_path)
```

### 9.3 ì‚°ì¶œë¬¼ êµ¬ì¡°

```
jobs/<folder>/deliverables/
â”œâ”€â”€ report.docx           # ë©”ì¸ ë³´ê³ ì„œ (Word)
â”œâ”€â”€ measurements.xlsx     # ì¸¡ì • ë°ì´í„° (Excel)
â”œâ”€â”€ report.pdf            # (ì˜µì…˜) PDF ë²„ì „
â””â”€â”€ photos/               # ì²¨ë¶€ ì‚¬ì§„ ì‚¬ë³¸
    â”œâ”€â”€ 01_overview.jpg
    â””â”€â”€ 02_label.jpg
```

---

## 10. êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: ì•ˆì „ ì½”ì–´ (core/)

| ìˆœì„œ | ëª¨ë“ˆ | ì„¤ëª… |
|------|------|------|
| 1 | `core/ssot_job.py` | job.json ë½/ê´€ë¦¬ (ê¸°ì¡´ ë¡œì§ ì´ë™) |
| 2 | `core/ids.py` | job_id/run_id ìƒì„± |
| 3 | `core/hashing.py` | packet_hash/full_hash |
| 4 | `core/photos.py` | rawâ†’derived, safe_move |
| 5 | `core/logging.py` | run log, override ë¡œê·¸ |

### Phase 2: AI íŒŒì‹± (app/services/)

| ìˆœì„œ | ëª¨ë“ˆ | ì„¤ëª… |
|------|------|------|
| 6 | `app/providers/base.py` | Provider ì¶”ìƒí™” |
| 7 | `app/providers/gemini.py` | Gemini OCR |
| 8 | `app/providers/anthropic.py` | Claude êµ¬ì¡°í™” |
| 9 | `app/services/intake.py` | intake_session.json |
| 10 | `app/services/ocr.py` | OCR ì„œë¹„ìŠ¤ |
| 11 | `app/services/extract.py` | êµ¬ì¡°í™” ì„œë¹„ìŠ¤ |
| 12 | `app/services/validate.py` | ê²€ì¦ + override |

### Phase 3: ì¶œë ¥ (render/)

| ìˆœì„œ | ëª¨ë“ˆ | ì„¤ëª… |
|------|------|------|
| 13 | `render/word.py` | DOCX ë Œë”ë§ |
| 14 | `render/excel.py` | XLSX ë Œë”ë§ |

### Phase 4: í…œí”Œë¦¿ (templates/)

| ìˆœì„œ | ëª¨ë“ˆ | ì„¤ëª… |
|------|------|------|
| 15 | `templates/manager.py` | í…œí”Œë¦¿ CRUD |
| 16 | `templates/scaffolder.py` | ì˜ˆì‹œâ†’í…œí”Œë¦¿ ìƒì„± |

### Phase 5: UI (app/)

| ìˆœì„œ | ëª¨ë“ˆ | ì„¤ëª… |
|------|------|------|
| 17 | `app/main.py` | FastAPI ì•± |
| 18 | `app/routes/chat.py` | ì±„íŒ… UI (HTMX) |
| 19 | `app/routes/templates.py` | í…œí”Œë¦¿ ê´€ë¦¬ |
| 20 | `app/routes/generate.py` | ìƒì„± ìš”ì²­ |

---

## 11. í•µì‹¬ ê²°ì • (ì‹¸ì›€ ë°©ì§€ìš©)

> ì´ ì„¹ì…˜ì˜ ê²°ì •ì€ êµ¬í˜„ ë‹¨ê³„ì—ì„œ ë…¼ìŸ ì—†ì´ ë”°ë¦…ë‹ˆë‹¤.

### 11.1 Model/Provider

```
LLM/OCR ëª¨ë¸ëª…ì€ ë¬¸ì„œ ë³¸ë¬¸ì— í•˜ë“œì½”ë”©í•˜ì§€ ì•ŠëŠ”ë‹¤.
configs/*.yamlë§Œ SSOTë¡œ í•œë‹¤.
Provider abstractionìœ¼ë¡œ ëª¨ë¸ êµì²´ ê°€ëŠ¥í•˜ê²Œ ìœ ì§€í•œë‹¤.
```

### 11.2 Entrypoint

```
CLI taskëŠ” ìµœì¢… êµ¬ì¡° ê¸°ì¤€ìœ¼ë¡œë§Œ ìœ ì§€í•œë‹¤:
- generate â†’ python -m src.core.pipeline
- serve â†’ python -m src.app.main
- register-template â†’ python -m src.templates.cli
```

### 11.3 Chat Transport

```
ê¸°ë³¸: REST + SSE (HTMX hx-sse)
WebSocket: ì˜µì…˜ (ì„±ëŠ¥ í•„ìš” ì‹œì—ë§Œ)
HTMX ê¸°ë°˜ ìµœì†Œ ìŠ¤íƒ ì² í•™ ìœ ì§€.
```

### 11.4 Immutability

```
intake_session.json ì›ë¬¸ì€ ì ˆëŒ€ ìˆ˜ì • ê¸ˆì§€ (append-only).
í›„ì²˜ë¦¬ ê²°ê³¼ëŠ” ë³„ë„ ì„¹ì…˜ìœ¼ë¡œ append.
ì‚¬ìš©ì ìˆ˜ì •ê°’ì€ user_correctionsì— ê¸°ë¡.
```

### 11.5 XLSX Mapping

```
ìš°ì„ ìˆœìœ„: named_ranges > cell_addresses
ë™ì¼ í•„ë“œì— ë‘˜ ë‹¤ ìˆìœ¼ë©´ ì—ëŸ¬ (fail-fast).
ì¸¡ì • í…Œì´ë¸”ì€ start_row ê¸°ë°˜ â†’ í…œí”Œë¦¿ì— í–‰ ì‚½ì…/ì‚­ì œ ê¸ˆì§€.
```

---

## 12. êµ¬í˜„ í˜„í™© (Implementation Status)

### Phase 1: ì•ˆì „ ì½”ì–´ (core/) âœ… ì™„ë£Œ

| ëª¨ë“ˆ | ìƒíƒœ | í…ŒìŠ¤íŠ¸ |
|------|:----:|:------:|
| `core/ssot_job.py` | âœ… | âœ… |
| `core/ids.py` | âœ… | âœ… |
| `core/hashing.py` | âœ… | âœ… |
| `core/photos.py` | âœ… | âœ… |
| `core/logging.py` | âœ… | âœ… |

### Phase 2: AI íŒŒì‹± (app/services/) âœ… ì™„ë£Œ

| ëª¨ë“ˆ | ìƒíƒœ | í…ŒìŠ¤íŠ¸ |
|------|:----:|:------:|
| `app/providers/base.py` | âœ… | âœ… |
| `app/providers/gemini.py` | âœ… | âœ… |
| `app/providers/anthropic.py` | âœ… | âœ… |
| `app/services/intake.py` | âœ… | âœ… |
| `app/services/extract.py` | âœ… | âœ… |
| `app/services/validate.py` | âœ… | âœ… |

### Phase 3: ì¶œë ¥ (render/) âœ… ì™„ë£Œ

| ëª¨ë“ˆ | ìƒíƒœ | í…ŒìŠ¤íŠ¸ |
|------|:----:|:------:|
| `render/word.py` | âœ… | âœ… |
| `render/excel.py` | âœ… | âœ… |

### Phase 4: í…œí”Œë¦¿ (templates/) âœ… ì™„ë£Œ

| ëª¨ë“ˆ | ìƒíƒœ | í…ŒìŠ¤íŠ¸ |
|------|:----:|:------:|
| `templates/manager.py` | âœ… | âœ… |
| `templates/scaffolder.py` | âœ… | âœ… |

### Phase 5: UI (app/) âœ… ì™„ë£Œ

| ëª¨ë“ˆ | ìƒíƒœ | í…ŒìŠ¤íŠ¸ |
|------|:----:|:------:|
| `app/main.py` | âœ… | âœ… |
| `app/config.py` | âœ… | âœ… |
| `app/routes/chat.py` | âœ… | âœ… |
| `app/routes/templates.py` | âœ… | âœ… |
| `app/routes/generate.py` | âœ… | âœ… |

### í…ŒìŠ¤íŠ¸ í˜„í™©

| ì¹´í…Œê³ ë¦¬ | í…ŒìŠ¤íŠ¸ ìˆ˜ | ìƒíƒœ |
|----------|-----------|:----:|
| Unit | 336 | âœ… |
| Integration | 26 | âœ… |
| E2E | 63 | âœ… |
| **ì´ê³„** | **425** | âœ… |

### CI/CD âœ… ì™„ë£Œ

| í•­ëª© | ìƒíƒœ | íŒŒì¼ |
|------|:----:|------|
| GitHub Actions | âœ… | `.github/workflows/ci.yml` |
| Lint (Ruff) | âœ… | `pyproject.toml` |
| Type Check (MyPy) | âœ… | `pyproject.toml` |
| Security (Bandit) | âœ… | `pyproject.toml` |

---

## ë²„ì „ ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ë³€ê²½ ì‚¬í•­ |
|------|------|-----------|
| 2.2.0 | 2024-12 | ì½”ë“œ í’ˆì§ˆ ì ê²€ ì™„ë£Œ (ruff 0 errors, mypy 0 errors) |
| 2.1.0 | 2024-12 | ì „ì²´ êµ¬í˜„ ì™„ë£Œ, í…ŒìŠ¤íŠ¸ 425ê°œ í†µê³¼, CI/CD ì„¤ì • |
| 2.0.0 | 2024-12 | ìŠ¤ì¼ˆë ˆí†¤ ì„¤ê³„ í™•ì • |
| 1.0.0 | 2024-11 | ì´ˆê¸° ì„¤ê³„ |
