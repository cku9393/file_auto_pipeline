{% extends "base.html" %}

{% block title %}ë¬¸ì„œ ìƒì„± - ì±„íŒ…{% endblock %}

{% block content %}
<div class="chat-container">
    <header class="chat-header">
        <h1>ğŸ“„ ë¬¸ì„œ ìƒì„±</h1>
        <select id="template-select" class="template-selector"
                hx-get="/api/chat/templates/options"
                hx-trigger="load"
                hx-swap="innerHTML">
            <option value="base">ë¡œë”© ì¤‘...</option>
        </select>
    </header>

    <div id="chat-messages" class="messages">
        <div class="message assistant">
            <div class="message-content">
                ì•ˆë…•í•˜ì„¸ìš”! ë¬¸ì„œ ìƒì„±ì„ ë„ì™€ë“œë¦´ê²Œìš”.<br>
                ì‘ì—… ì •ë³´ë¥¼ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>
                <small>(ì—‘ì…€, ì‚¬ì§„, PDF ë“± íŒŒì¼ë„ ì²¨ë¶€ ê°€ëŠ¥í•©ë‹ˆë‹¤)</small>
            </div>
        </div>
    </div>

    <form id="chat-form" class="chat-input-form"
          hx-post="/api/chat/message"
          hx-target="#chat-messages"
          hx-swap="beforeend"
          hx-indicator="#loading">

        <input type="hidden" name="session_id" id="session-id" value="{{ session_id }}">

        <div id="file-preview" class="file-preview"></div>

        <div class="input-row">
            <textarea name="content"
                      placeholder="ë©”ì‹œì§€ ì…ë ¥... (ì˜ˆ: WO-001, L1 ë¼ì¸, PART-A í’ˆë²ˆì´ì•¼)"
                      rows="2"
                      required></textarea>

            <div class="input-buttons">
                <input type="file" id="file-input" name="files" multiple hidden
                       accept=".xlsx,.xls,.pdf,.jpg,.jpeg,.png">
                <button type="button" class="btn-icon" onclick="document.getElementById('file-input').click()">
                    ğŸ“
                </button>
                <button type="submit" class="btn-primary">ì „ì†¡</button>
            </div>
        </div>
    </form>

    <div id="loading" class="loading-indicator">
        <span>ì²˜ë¦¬ ì¤‘...</span>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸°
document.getElementById('file-input').addEventListener('change', function(e) {
    const preview = document.getElementById('file-preview');
    preview.innerHTML = '';

    for (const file of e.target.files) {
        const chip = document.createElement('span');
        chip.className = 'file-chip';
        chip.textContent = `ğŸ“ ${file.name}`;
        preview.appendChild(chip);
    }
});

// í¼ ì œì¶œ í›„ ì…ë ¥ ì´ˆê¸°í™”
document.getElementById('chat-form').addEventListener('htmx:afterRequest', function(e) {
    if (e.detail.successful) {
        e.target.querySelector('textarea').value = '';
        document.getElementById('file-preview').innerHTML = '';
        document.getElementById('file-input').value = '';
    }
});
</script>
{% endblock %}
